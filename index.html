<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>æ¼¢å­—ãƒ†ã‚¹ãƒˆå¯¾ç­– | ã“ã¨ã‚ã–ãƒ»é›£èª­èª</title>
    <meta name="description" content="æ¼¢å­—ãƒ†ã‚¹ãƒˆå¯¾ç­–ã‚¢ãƒ—ãƒªã€‚é›£èª­æ¼¢å­—ãƒ»ã“ã¨ã‚ã–ãƒ»ç©´åŸ‹ã‚å•é¡Œã‚’æš—è¨˜ãƒ¢ãƒ¼ãƒ‰ã¨ã‚¯ã‚¤ã‚ºãƒ¢ãƒ¼ãƒ‰ã§å­¦ç¿’ã§ãã¾ã™ã€‚">

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        zen: ['"Zen Maru Gothic"', '"M PLUS Rounded 1c"', 'sans-serif'],
                        mplus: ['"M PLUS Rounded 1c"', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <!-- Google Fonts preconnect + preload -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;700;900&family=Zen+Maru+Gothic:wght@400;700;900&display=swap"
        rel="stylesheet">

    <style>
        /* ãƒ•ã‚©ãƒ³ãƒˆèª­ã¿è¾¼ã¿å‰ã® FOUC/FOUT å¯¾ç­– */
        html {
            font-family: 'Zen Maru Gothic', 'M PLUS Rounded 1c', 'Hiragino Kaku Gothic ProN', 'ãƒ¡ã‚¤ãƒªã‚ª', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* åŸºåº•ã‚¹ã‚¿ã‚¤ãƒ« */
        *,
        *::before,
        *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            background-color: #0f172a;
            color: #e2e8f0;
            font-family: 'Zen Maru Gothic', 'M PLUS Rounded 1c', sans-serif;
            min-height: 100dvh;
            overflow-x: hidden;
            touch-action: manipulation;
            /* ã‚¿ãƒƒãƒ—é…å»¶é˜²æ­¢ */
            -webkit-tap-highlight-color: transparent;
        }

        /* è»½é‡èƒŒæ™¯è£…é£¾ (CSS only, no blur/canvas) */
        body::before {
            content: '';
            position: fixed;
            top: -30%;
            right: -20%;
            width: 500px;
            height: 500px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(14, 165, 233, 0.08) 0%, transparent 70%);
            pointer-events: none;
            z-index: 0;
        }

        body::after {
            content: '';
            position: fixed;
            bottom: -20%;
            left: -15%;
            width: 400px;
            height: 400px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(99, 102, 241, 0.06) 0%, transparent 70%);
            pointer-events: none;
            z-index: 0;
        }

        /* ç”»é¢åˆ‡ã‚Šæ›¿ãˆã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        .screen {
            display: none;
            position: relative;
            z-index: 1;
        }

        .screen.active {
            display: block;
            animation: fadeIn 0.2s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(8px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* å…±é€šãƒœã‚¿ãƒ³ */
        .btn-primary {
            background: linear-gradient(135deg, #0ea5e9 0%, #2563eb 100%);
            color: #fff;
            border: none;
            border-radius: 12px;
            padding: 14px 28px;
            font-size: 1.05rem;
            font-weight: 700;
            font-family: inherit;
            cursor: pointer;
            transition: transform 0.1s ease, box-shadow 0.15s ease;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
            box-shadow: 0 4px 14px rgba(14, 165, 233, 0.25);
        }

        .btn-primary:active {
            transform: scale(0.97);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.06);
            color: #94a3b8;
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 10px;
            padding: 10px 20px;
            font-size: 0.9rem;
            font-weight: 700;
            font-family: inherit;
            cursor: pointer;
            transition: background 0.15s, color 0.15s;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }

        .btn-secondary:hover,
        .btn-secondary.active-filter {
            background: rgba(14, 165, 233, 0.15);
            color: #38bdf8;
            border-color: rgba(14, 165, 233, 0.3);
        }

        /* é¸æŠè‚¢ãƒœã‚¿ãƒ³ */
        .choice-btn {
            width: 100%;
            text-align: left;
            background: rgba(255, 255, 255, 0.04);
            color: #cbd5e1;
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            padding: 14px 18px;
            font-size: 1rem;
            font-weight: 700;
            font-family: inherit;
            cursor: pointer;
            transition: background 0.1s, border-color 0.1s, transform 0.08s;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
            position: relative;
        }

        .choice-btn:active {
            transform: scale(0.98);
        }

        .choice-btn.correct {
            background: rgba(34, 197, 94, 0.15) !important;
            border-color: #22c55e !important;
            color: #4ade80 !important;
        }

        .choice-btn.wrong {
            background: rgba(239, 68, 68, 0.15) !important;
            border-color: #ef4444 !important;
            color: #f87171 !important;
        }

        .choice-btn.disabled {
            pointer-events: none;
            opacity: 0.5;
        }

        /* ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ã‚«ãƒ¼ãƒ‰ */
        .flashcard-item {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.06);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: background 0.15s;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }

        .flashcard-item:active {
            background: rgba(255, 255, 255, 0.06);
        }

        .flashcard-answer {
            max-height: 0;
            overflow: hidden;
            opacity: 0;
            transition: max-height 0.25s ease, opacity 0.2s ease, margin-top 0.2s ease;
            margin-top: 0;
        }

        .flashcard-answer.open {
            max-height: 200px;
            opacity: 1;
            margin-top: 12px;
        }

        /* çµæœã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ */
        .result-overlay {
            position: fixed;
            inset: 0;
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(15, 23, 42, 0.85);
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.15s ease, visibility 0.15s ease;
        }

        .result-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .result-card {
            background: #1e293b;
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 20px;
            padding: 32px 28px;
            text-align: center;
            max-width: 360px;
            width: 90%;
            transform: scale(0.92);
            transition: transform 0.2s ease;
        }

        .result-overlay.show .result-card {
            transform: scale(1);
        }

        /* æœ€çµ‚çµæœç”»é¢ã®ãƒãƒ¼ */
        .score-bar-bg {
            width: 100%;
            height: 10px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 5px;
            overflow: hidden;
        }

        .score-bar-fill {
            height: 100%;
            border-radius: 5px;
            background: linear-gradient(90deg, #0ea5e9, #22c55e);
            transition: width 0.6s ease;
        }

        /* ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ */
        .progress-bar {
            width: 100%;
            height: 4px;
            background: rgba(255, 255, 255, 0.06);
            border-radius: 2px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #0ea5e9, #38bdf8);
            transition: width 0.2s ease;
            border-radius: 2px;
        }

        /* ã‚¿ã‚°ãƒãƒƒã‚¸ */
        .cat-badge {
            display: inline-block;
            font-size: 0.7rem;
            font-weight: 700;
            padding: 2px 8px;
            border-radius: 6px;
            background: rgba(14, 165, 233, 0.12);
            color: #38bdf8;
        }

        /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ */
        ::-webkit-scrollbar {
            width: 4px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
        }
    </style>
</head>

<body>

    <!-- ======================== ã‚¹ã‚¿ãƒ¼ãƒˆç”»é¢ ======================== -->
    <div id="screen-start" class="screen active">
        <div class="flex flex-col items-center justify-center min-h-dvh px-5 py-10">
            <!-- ãƒ­ã‚´ -->
            <div class="mb-3">
                <span class="text-5xl">ğŸ“š</span>
            </div>
            <h1 class="text-3xl font-black text-white mb-2 tracking-tight"
                style="font-family:'Zen Maru Gothic',sans-serif;">æ¼¢å­—ãƒ†ã‚¹ãƒˆå¯¾ç­–</h1>
            <p class="text-sm text-slate-400 mb-10">ã“ã¨ã‚ã–ãƒ»é›£èª­èª</p>

            <!-- ãƒ¢ãƒ¼ãƒ‰é¸æŠ -->
            <div class="w-full max-w-xs space-y-4">
                <button onclick="App.startFlashcard()"
                    class="btn-primary w-full flex items-center justify-center gap-3">
                    <span class="text-xl">ğŸ—‚ï¸</span>
                    <span>æš—è¨˜ãƒ¢ãƒ¼ãƒ‰</span>
                </button>
                <button onclick="App.startQuiz()" class="btn-primary w-full flex items-center justify-center gap-3"
                    style="background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%); box-shadow: 0 4px 14px rgba(99,102,241,0.25);">
                    <span class="text-xl">âœï¸</span>
                    <span>å®Ÿè·µãƒ†ã‚¹ãƒˆ</span>
                </button>
            </div>

            <!-- çµ±è¨ˆè¡¨ç¤º -->
            <div class="mt-10 flex gap-6 text-center">
                <div>
                    <div class="text-2xl font-black text-sky-400" id="stat-total">0</div>
                    <div class="text-xs text-slate-500">ç·å•é¡Œæ•°</div>
                </div>
                <div>
                    <div class="text-2xl font-black text-emerald-400" id="stat-cats">0</div>
                    <div class="text-xs text-slate-500">ã‚«ãƒ†ã‚´ãƒª</div>
                </div>
            </div>
        </div>
    </div>

    <!-- ======================== æš—è¨˜ãƒ¢ãƒ¼ãƒ‰ ======================== -->
    <div id="screen-flashcard" class="screen">
        <div class="max-w-lg mx-auto px-4 py-6 min-h-dvh">
            <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
            <div class="flex items-center justify-between mb-5">
                <button onclick="App.goHome()" class="btn-secondary text-sm px-3 py-2">â† æˆ»ã‚‹</button>
                <h2 class="text-lg font-bold text-white">ğŸ—‚ï¸ æš—è¨˜ãƒ¢ãƒ¼ãƒ‰</h2>
                <div class="w-16"></div>
            </div>

            <!-- ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ -->
            <div id="filter-bar" class="flex gap-2 mb-5 overflow-x-auto pb-2 scrollbar-hide"></div>

            <!-- ã‚«ãƒ¼ãƒ‰ãƒªã‚¹ãƒˆ -->
            <div id="flashcard-list" class="space-y-0"></div>
        </div>
    </div>

    <!-- ======================== ã‚¯ã‚¤ã‚ºãƒ¢ãƒ¼ãƒ‰ ======================== -->
    <div id="screen-quiz" class="screen">
        <div class="max-w-lg mx-auto px-4 py-6 min-h-dvh flex flex-col">
            <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
            <div class="flex items-center justify-between mb-3">
                <button onclick="App.goHome()" class="btn-secondary text-sm px-3 py-2">â† æˆ»ã‚‹</button>
                <div class="text-sm text-slate-400 font-bold" id="quiz-counter">1 / 10</div>
                <div class="w-16"></div>
            </div>

            <!-- ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ -->
            <div class="progress-bar mb-6">
                <div class="progress-fill" id="quiz-progress" style="width:0%"></div>
            </div>

            <!-- å•é¡Œã‚«ãƒ¼ãƒ‰ -->
            <div class="flex-1 flex flex-col justify-center">
                <div class="text-center mb-8">
                    <span class="cat-badge mb-3 inline-block" id="quiz-cat"></span>
                    <div class="text-xs text-slate-500 mb-2" id="quiz-type-label"></div>
                    <div class="text-4xl font-black text-white leading-tight" id="quiz-question"
                        style="font-family:'Zen Maru Gothic',sans-serif;"></div>
                </div>

                <!-- é¸æŠè‚¢ -->
                <div class="space-y-3" id="quiz-choices"></div>
            </div>
        </div>
    </div>

    <!-- ======================== æœ€çµ‚çµæœç”»é¢ ======================== -->
    <div id="screen-result" class="screen">
        <div class="flex flex-col items-center justify-center min-h-dvh px-5 py-10">
            <div class="text-5xl mb-4" id="result-emoji">ğŸ‰</div>
            <h2 class="text-2xl font-black text-white mb-1">ãƒ†ã‚¹ãƒˆçµæœ</h2>
            <p class="text-slate-400 text-sm mb-6">ãŠã¤ã‹ã‚Œã•ã¾ã§ã—ãŸï¼</p>

            <!-- ã‚¹ã‚³ã‚¢ -->
            <div class="text-6xl font-black mb-2" id="result-score"
                style="background: linear-gradient(135deg,#0ea5e9,#22c55e); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
                0%</div>
            <div class="text-sm text-slate-400 mb-4" id="result-detail">0 / 0 å•æ­£è§£</div>

            <!-- ã‚¹ã‚³ã‚¢ãƒãƒ¼ -->
            <div class="w-full max-w-xs mb-8">
                <div class="score-bar-bg">
                    <div class="score-bar-fill" id="result-bar" style="width:0%"></div>
                </div>
            </div>

            <!-- é–“é•ãˆãŸå•é¡Œä¸€è¦§ -->
            <div class="w-full max-w-sm mb-8" id="result-wrong-section" style="display:none;">
                <h3 class="text-sm font-bold text-slate-400 mb-3">é–“é•ãˆãŸå•é¡Œ</h3>
                <div id="result-wrong-list" class="space-y-2"></div>
            </div>

            <!-- ãƒœã‚¿ãƒ³ -->
            <div class="space-y-3 w-full max-w-xs">
                <button onclick="App.startQuiz()" class="btn-primary w-full">ã‚‚ã†ä¸€åº¦ãƒãƒ£ãƒ¬ãƒ³ã‚¸</button>
                <button onclick="App.goHome()" class="btn-secondary w-full">ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹</button>
            </div>
        </div>
    </div>

    <!-- ======================== çµæœã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ ======================== -->
    <div id="result-overlay" class="result-overlay">
        <div class="result-card">
            <div class="text-5xl mb-3" id="overlay-icon">â­•</div>
            <div class="text-xl font-black mb-1" id="overlay-title">æ­£è§£ï¼</div>
            <div class="text-3xl font-black text-white my-3" id="overlay-answer"
                style="font-family:'Zen Maru Gothic',sans-serif;"></div>
            <p class="text-sm text-slate-400 leading-relaxed mb-5" id="overlay-desc"></p>
            <button onclick="App.nextQuestion()" class="btn-primary w-full" id="overlay-next-btn">æ¬¡ã®å•é¡Œã¸ â†’</button>
        </div>
    </div>


    <script>
        // ==================== ãƒ‡ãƒ¼ã‚¿ ====================
        const DATA = [
            { id: 1, type: "reading", q: "èºŠèº‡", a: "ã¡ã‚…ã†ã¡ã‚‡", wrong: ["ã¡ã‚…ã†ã—ã‚‡", "ã—ã‚…ã†ã¡ã‚‡", "ã˜ã‚…ã†ã—ã‚‡"], cat: "é›£èª­", desc: "æ±ºå¿ƒãŒã¤ã‹ãšã€ããšããšã™ã‚‹ã“ã¨ã€‚ãŸã‚ã‚‰ã„ã€‚" },
            { id: 2, type: "reading", q: "æ‹˜æ³¥", a: "ã“ã†ã§ã„", wrong: ["ã“ã†ã©ã‚", "ãã§ã„", "ã‹ã¦ã„"], cat: "é›£èª­", desc: "æ°—ã«ã—ã¦ã“ã ã‚ã‚‹ã“ã¨ã€‚å¿…è¦ä»¥ä¸Šã«æ°—ã«ã™ã‚‹ã“ã¨ã€‚" },
            { id: 3, type: "reading", q: "èª¤è¬¬", a: "ã”ã³ã‚…ã†", wrong: ["ã”ã³ã‚‡ã†", "ã”ã‚Šã‚…ã†", "ã”ã“ã†"], cat: "é›£èª­", desc: "ã¾ã¡ãŒã„ã€‚ã‚ã‚„ã¾ã‚Šã€‚" },
            { id: 4, type: "reading", q: "å®Œé‚", a: "ã‹ã‚“ã™ã„", wrong: ["ã‹ã‚“ã¤ã„", "ã‹ã‚“ãœã„", "ã‹ã‚“ã—ã‚‡ã†"], cat: "é›£èª­", desc: "æœ€å¾Œã¾ã§ã‚„ã‚Šã¨ãŠã™ã“ã¨ã€‚" },
            { id: 5, type: "reading", q: "å¿Œæ†š", a: "ããŸã‚“", wrong: ["ãã ã‚“", "ã„ã¿", "ãã¶ã‚“"], cat: "é›£èª­", desc: "é æ…®ã™ã‚‹ã“ã¨ã€‚å«Œã„å«ŒãŒã‚‹ã“ã¨ã€‚ã€Œå¿Œæ†šã®ãªã„æ„è¦‹ã€ãªã©ã§ä½¿ã†ã€‚" },
            { id: 6, type: "reading", q: "æ€ªè¨", a: "ã‘ã’ã‚“", wrong: ["ã‹ã„ãŒ", "ã‹ã„ã‚", "ã‘ãŒ"], cat: "é›£èª­", desc: "ä¸æ€è­°ã§ç´å¾—ãŒã„ã‹ãªã„ã•ã¾ã€‚" },
            { id: 7, type: "reading", q: "è¨€è³ª", a: "ã’ã‚“ã¡", wrong: ["ã’ã‚“ã—ã¤", "ã’ã‚“ã—", "ã“ã¨ã˜ã¡"], cat: "é›£èª­", desc: "å¾Œã§è¨¼æ‹ ã¨ãªã‚‹ã‚ˆã†ãªè¨€è‘‰ã€‚ã€Œè¨€è³ªã‚’å–ã‚‹ã€" },
            { id: 8, type: "reading", q: "å¸‚äº•", a: "ã—ã›ã„", wrong: ["ã„ã¡ã„", "ã—ã—ã‚‡ã†", "ã—ã˜ã‚‡ã†"], cat: "é›£èª­", desc: "äººå®¶ãŒé›†ã¾ã£ã¦ã„ã‚‹æ‰€ã€‚ã¾ã¡ã€‚ä¸–é–“ã€‚" },
            { id: 9, type: "reading", q: "è´”å±“", a: "ã²ã„ã", wrong: ["ã‹ã„ãŒã„", "ã²ã", "ãããã"], cat: "é›£èª­", desc: "æ°—ã«å…¥ã£ãŸè€…ã‚’ç‰¹ã«å¼•ãç«‹ã¦ã‚‹ã“ã¨ã€‚" },
            { id: 10, type: "reading", q: "ä¹–é›¢", a: "ã‹ã„ã‚Š", wrong: ["ã˜ã‚‡ã†ã‚Š", "ã¯ã„ã‚Š", "ãã‚‡ã‚Š"], cat: "é›£èª­", desc: "ãã‚€ãã¯ãªã‚Œã‚‹ã“ã¨ã€‚çµã³ã¤ããŒé›¢ã‚Œã‚‹ã“ã¨ã€‚" },
            { id: 11, type: "reading", q: "å„„åŠ«", a: "ãŠã£ãã†", wrong: ["ãŠããã†", "ãŠã£ã“ã†", "ãŠãŠãã†"], cat: "é›£èª­", desc: "é¢å€’ã§æ°—ãŒé€²ã¾ãªã„ã“ã¨ã€‚" },
            { id: 12, type: "reading", q: "æ–¡æ—‹", a: "ã‚ã£ã›ã‚“", wrong: ["ã‹ã‚“ã›ã‚“", "ã‚ã¤ã›ã‚“", "ã‚ã•ã›ã‚“"], cat: "é›£èª­", desc: "é–“ã«å…¥ã£ã¦åŒæ–¹ã‚’ã†ã¾ãå–ã‚ŠæŒã¤ã“ã¨ã€‚" },
            { id: 13, type: "reading", q: "ç›´æˆª", a: "ã¡ã‚‡ãã›ã¤", wrong: ["ã¡ã‚‡ãã•ã„", "ã¡ã‚‡ãã•ã¤", "ã˜ãã•ã„"], cat: "é›£èª­", desc: "ã¾ã‚ã‚Šãã©ããªãã€ãšã°ã‚Šã¨ã—ã¦ã„ã‚‹ã“ã¨ã€‚" },
            { id: 14, type: "reading", q: "ç‹¡çŒ¾", a: "ã“ã†ã‹ã¤", wrong: ["ã“ã†ã‚ã", "ãã‚‡ã†ã‹ã¤", "ã“ã†ã“ã¤"], cat: "é›£èª­", desc: "æ‚ªè³¢ã„ã“ã¨ã€‚ãšã‚‹ã„ã“ã¨ã€‚" },
            { id: 15, type: "reading", q: "å¹è´", a: "ãµã„ã¡ã‚‡ã†", wrong: ["ã™ã„ã¡ã‚‡ã†", "ãµã„ã¨ã", "ãµã†ã¡ã‚‡ã†"], cat: "é›£èª­", desc: "å¤šãã®äººã«è¨€ã„ãµã‚‰ã™ã“ã¨ã€‚" },
            { id: 16, type: "reading", q: "å—šå’½", a: "ãŠãˆã¤", wrong: ["ãŠã„ã¤", "ã‚ã„ãˆã¤", "ãŠãˆã‚“"], cat: "é›£èª­", desc: "å£°ã‚’è©°ã¾ã‚‰ã›ã¦æ³£ãã“ã¨ã€‚ã‚€ã›ã³æ³£ãã€‚" },
            { id: 17, type: "reading", q: "è«§è¬”", a: "ã‹ã„ãã‚ƒã", wrong: ["ã‹ã„ãã‚‡", "ã¡ã‚‡ã†ã—ã‚‡ã†", "ã‹ã„ã’ã"], cat: "é›£èª­", desc: "ãŠã‚‚ã—ã‚ã¿ã®ã‚ã‚‹æ°—ã®åˆ©ã„ãŸè¨€è‘‰ã€‚ãƒ¦ãƒ¼ãƒ¢ã‚¢ã€‚" },
            { id: 18, type: "reading", q: "è»‹è½¢", a: "ã‚ã¤ã‚Œã", wrong: ["ãã‚Œã", "ã–ã¤ã‚Œã", "ã‚ã¤ã‚‰ã"], cat: "é›£èª­", desc: "è»Šè¼ªãŒãã—ã‚‹ã“ã¨ã€‚è»¢ã˜ã¦ã€äººã¨äººã¨ã®ä»²ãŒæ‚ªããªã‚‹ã“ã¨ã€‚" },
            { id: 19, type: "reading", q: "è•¨", a: "ã‚ã‚‰ã³", wrong: ["ã‚ã‚‰", "ã„ã°ã‚‰", "ã‚‚ãšã"], cat: "ç”Ÿç‰©", desc: "å±±èœã®ä¸€ç¨®ã€‚æ˜¥ã«ã“ã¶ã—çŠ¶ã®è‹¥èŠ½ã‚’å‡ºã™ã€‚" },
            { id: 20, type: "reading", q: "ä¸å¦‚å¸°", a: "ã»ã¨ã¨ãã™", wrong: ["ã†ãã„ã™", "ã²ã°ã‚Š", "ã‹ã‚ã›ã¿"], cat: "ç”Ÿç‰©", desc: "åˆå¤ã«æ¸¡æ¥ã—ã€ç‹¬ç‰¹ã®é³´ãå£°ã‚’ã™ã‚‹é³¥ã€‚" },
            { id: 21, type: "reading", q: "é›²é›€", a: "ã²ã°ã‚Š", wrong: ["ã²ã°ã‚‰", "ãã‚‚ã™ãšã‚", "ã¤ã°ã‚"], cat: "ç”Ÿç‰©", desc: "æ˜¥ã€ç©ºé«˜ãèˆã„ä¸ŠãŒã£ã¦ã•ãˆãšã‚‹é³¥ã€‚" },
            { id: 22, type: "reading", q: "ç„¡èŠ±æœ", a: "ã„ã¡ã˜ã", wrong: ["ã–ãã‚", "ã‚ã‘ã³", "ãƒ‘ãƒ‘ã‚¤ã‚¢"], cat: "ç”Ÿç‰©", desc: "èŠ±ãŒå’²ã‹ãªã„ã‚ˆã†ã«è¦‹ãˆã¦å®ŸãŒãªã‚‹æ¤ç‰©ã€‚" },
            { id: 23, type: "reading", q: "ç™¾èˆŒ", a: "ã‚‚ãš", wrong: ["ã²ã‚ƒãã—ãŸ", "ã¤ãã¿", "ã†ãšã‚‰"], cat: "ç”Ÿç‰©", desc: "ç§‹ã«é«˜é³´ãã‚’ã™ã‚‹é³¥ã€‚ã€Œç™¾èˆŒã®æ—©è´„ã€ã§æœ‰åã€‚" },
            { id: 24, type: "reading", q: "è›¤", a: "ã¯ã¾ãã‚Š", wrong: ["ã‚ã•ã‚Š", "ã—ã˜ã¿", "ã•ã–ãˆ"], cat: "ç”Ÿç‰©", desc: "äºŒæšè²ã®ä¸€ç¨®ã€‚ã²ãªç¥­ã‚Šã®å¸ã„ç‰©ãªã©ã«ä½¿ã‚ã‚Œã‚‹ã€‚" },
            { id: 30, type: "fill", q: "ï¼Ÿéš ã—ã¦å°»éš ã•ãš", a: "é ­", wrong: ["é¡”", "æ‰‹", "è¶³"], cat: "ã“ã¨ã‚ã–", desc: "æ‚ªäº‹ã‚„æ¬ ç‚¹ã®ä¸€éƒ¨ã‚’éš ã—ãŸã¤ã‚‚ã‚Šã§ã‚‚ã€ä»–ã®éƒ¨åˆ†ãŒç¾ã‚Œã¦ã„ã‚‹ã“ã¨ã€‚" },
            { id: 31, type: "fill", q: "é¬¼ã®ï¼Ÿã«ã‚‚æ¶™", a: "ç›®", wrong: ["é¡”", "å¿ƒ", "è§’"], cat: "ã“ã¨ã‚ã–", desc: "ç„¡æ…ˆæ‚²ãªäººã§ã‚‚ã€æ™‚ã«ã¯æ…ˆæ‚²ã®å¿ƒã‚’èµ·ã“ã—ã¦æ¶™ã‚’æµã™ã“ã¨ã€‚" },
            { id: 32, type: "fill", q: "ï¼Ÿã«ãŸã“ãŒã§ãã‚‹", a: "è€³", wrong: ["æ‰‹", "è¶³", "æŒ‡"], cat: "ã“ã¨ã‚ã–", desc: "åŒã˜ã“ã¨ã‚’ä½•åº¦ã‚‚èã‹ã•ã‚Œã¦å«Œã«ãªã‚‹ã“ã¨ã€‚" },
            { id: 34, type: "fill", q: "ï¼Ÿå…«ä¸æ‰‹å…«ä¸", a: "å£", wrong: ["èˆŒ", "é ­", "å£°"], cat: "ã“ã¨ã‚ã–", desc: "ã€Œå£å…«ä¸æ‰‹å…«ä¸ã€ã€‚ã—ã‚ƒã¹ã‚‹ã“ã¨ã‚‚ã‚„ã‚‹ã“ã¨ã‚‚é”è€…ãªã“ã¨ã€‚" },
            { id: 40, type: "fill", q: "ï¼Ÿã®é å ãˆ", a: "çŠ¬", wrong: ["ç‹¼", "ç‹", "è™"], cat: "å‹•ç‰©", desc: "è‡†ç—…è€…ãŒé™°ã§å¨å¼µã£ãŸã‚Šã€ä»–äººã®æ‚ªå£ã‚’è¨€ã£ãŸã‚Šã™ã‚‹ã“ã¨ã€‚" },
            { id: 41, type: "fill", q: "ï¼Ÿã®è€³ã«å¿µä»", a: "é¦¬", wrong: ["ç‰›", "è±š", "ç¾Š"], cat: "å‹•ç‰©", desc: "ã„ãã‚‰æ„è¦‹ã‚’ã—ã¦ã‚‚åŠ¹ãç›®ãŒãªã„ã“ã¨ã€‚" },
            { id: 42, type: "fill", q: "ï¼Ÿã‚‚æœ¨ã‹ã‚‰è½ã¡ã‚‹", a: "çŒ¿", wrong: ["çŒ«", "é³¥", "ãƒªã‚¹"], cat: "å‹•ç‰©", desc: "é”äººã§ã‚‚å¤±æ•—ã™ã‚‹ã“ã¨ãŒã‚ã‚‹ã€‚å¼˜æ³•ã«ã‚‚ç­†ã®èª¤ã‚Šã€‚" },
            { id: 43, type: "fill", q: "ï¼Ÿã‚‚æ“å­ã‚‚", a: "çŒ«", wrong: ["çŠ¬", "ç‰›", "ãƒã‚ºãƒŸ"], cat: "å‹•ç‰©", desc: "ä½•ã‚‚ã‹ã‚‚ã™ã¹ã¦ã€‚ã ã‚Œã‚‚ã‹ã‚Œã‚‚ã€‚" },
            { id: 44, type: "fill", q: "ï¼Ÿã®ä¸€å£°", a: "é¶´", wrong: ["é›€", "é·²", "é·¹"], cat: "å‹•ç‰©", desc: "å¤šãã®è­°è«–ã‚’æŠ‘ãˆã¦æ±ºå®šã™ã‚‹æ¨©åŠ›è€…ã®ä¸€è¨€ã€‚" },
            { id: 45, type: "fill", q: "ï¼Ÿã®æ¶™", a: "é›€", wrong: ["èœ‚", "èšŠ", "è‰"], cat: "å‹•ç‰©", desc: "ã»ã‚“ã®ã‚ãšã‹ãªã“ã¨ã€‚" }
        ];

        // ==================== ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ ====================
        const App = (() => {
            // è¦ç´ ã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼ˆDOMã‚¢ã‚¯ã‚»ã‚¹ã‚’æœ€å°åŒ–ï¼‰
            const $ = (id) => document.getElementById(id);
            const screens = {};
            const els = {};

            // çŠ¶æ…‹
            let quizQuestions = [];
            let currentIndex = 0;
            let score = 0;
            let wrongList = [];
            let answered = false;
            let currentFilter = 'all';

            // ã‚«ãƒ†ã‚´ãƒªä¸€è¦§ã®å–å¾—
            const categories = [...new Set(DATA.map(d => d.cat))];

            // ==================== åˆæœŸåŒ– ====================
            function init() {
                // ç”»é¢è¦ç´ ã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥
                screens.start = $('screen-start');
                screens.flashcard = $('screen-flashcard');
                screens.quiz = $('screen-quiz');
                screens.result = $('screen-result');

                // ã‚ˆãä½¿ã†è¦ç´ ã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥
                els.filterBar = $('filter-bar');
                els.flashcardList = $('flashcard-list');
                els.quizCounter = $('quiz-counter');
                els.quizProgress = $('quiz-progress');
                els.quizCat = $('quiz-cat');
                els.quizTypeLabel = $('quiz-type-label');
                els.quizQuestion = $('quiz-question');
                els.quizChoices = $('quiz-choices');
                els.resultOverlay = $('result-overlay');
                els.overlayIcon = $('overlay-icon');
                els.overlayTitle = $('overlay-title');
                els.overlayAnswer = $('overlay-answer');
                els.overlayDesc = $('overlay-desc');
                els.overlayNextBtn = $('overlay-next-btn');
                els.resultEmoji = $('result-emoji');
                els.resultScore = $('result-score');
                els.resultDetail = $('result-detail');
                els.resultBar = $('result-bar');
                els.resultWrongSection = $('result-wrong-section');
                els.resultWrongList = $('result-wrong-list');

                // ã‚¹ã‚¿ãƒ¼ãƒˆç”»é¢ã®çµ±è¨ˆ
                $('stat-total').textContent = DATA.length;
                $('stat-cats').textContent = categories.length;
            }

            // ==================== ç”»é¢åˆ‡ã‚Šæ›¿ãˆ ====================
            function showScreen(name) {
                for (const key in screens) {
                    if (key === name) {
                        screens[key].classList.add('active');
                    } else {
                        screens[key].classList.remove('active');
                    }
                }
            }

            function goHome() {
                els.resultOverlay.classList.remove('show');
                showScreen('start');
            }

            // ==================== ã‚·ãƒ£ãƒƒãƒ•ãƒ« ====================
            function shuffle(arr) {
                const a = arr.slice();
                for (let i = a.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [a[i], a[j]] = [a[j], a[i]];
                }
                return a;
            }

            // ==================== æš—è¨˜ãƒ¢ãƒ¼ãƒ‰ ====================
            function startFlashcard() {
                showScreen('flashcard');
                currentFilter = 'all';
                renderFilterBar();
                renderFlashcards();
            }

            function renderFilterBar() {
                // DocumentFragmentã§ä¸€æ‹¬æ›¸ãè¾¼ã¿
                const frag = document.createDocumentFragment();

                const allBtn = document.createElement('button');
                allBtn.className = 'btn-secondary text-xs whitespace-nowrap' + (currentFilter === 'all' ? ' active-filter' : '');
                allBtn.textContent = 'ã™ã¹ã¦';
                allBtn.addEventListener('click', () => {
                    currentFilter = 'all';
                    renderFilterBar();
                    renderFlashcards();
                }, { passive: true });
                frag.appendChild(allBtn);

                categories.forEach(cat => {
                    const btn = document.createElement('button');
                    btn.className = 'btn-secondary text-xs whitespace-nowrap' + (currentFilter === cat ? ' active-filter' : '');
                    btn.textContent = cat;
                    btn.addEventListener('click', () => {
                        currentFilter = cat;
                        renderFilterBar();
                        renderFlashcards();
                    }, { passive: true });
                    frag.appendChild(btn);
                });

                els.filterBar.innerHTML = '';
                els.filterBar.appendChild(frag);
            }

            function renderFlashcards() {
                const filtered = currentFilter === 'all' ? DATA : DATA.filter(d => d.cat === currentFilter);
                const frag = document.createDocumentFragment();

                filtered.forEach(item => {
                    const card = document.createElement('div');
                    card.className = 'flashcard-item';

                    const topRow = document.createElement('div');
                    topRow.className = 'flex items-center justify-between';

                    const qText = document.createElement('span');
                    qText.className = 'text-lg font-bold text-white';
                    qText.style.fontFamily = "'Zen Maru Gothic', sans-serif";
                    qText.textContent = item.q;

                    const badge = document.createElement('span');
                    badge.className = 'cat-badge';
                    badge.textContent = item.cat;

                    topRow.appendChild(qText);
                    topRow.appendChild(badge);

                    const answerDiv = document.createElement('div');
                    answerDiv.className = 'flashcard-answer';

                    const aDivider = document.createElement('div');
                    aDivider.className = 'border-t border-slate-700 pt-3';

                    const aLabel = document.createElement('div');
                    aLabel.className = 'text-sky-400 font-bold text-base mb-1';
                    aLabel.textContent = item.a;

                    const aDesc = document.createElement('div');
                    aDesc.className = 'text-slate-400 text-sm leading-relaxed';
                    aDesc.textContent = item.desc;

                    aDivider.appendChild(aLabel);
                    aDivider.appendChild(aDesc);
                    answerDiv.appendChild(aDivider);

                    card.appendChild(topRow);
                    card.appendChild(answerDiv);

                    // ã‚¿ãƒƒãƒ—ã§é–‹é–‰ï¼ˆå³åº§ã«åå¿œï¼‰
                    card.addEventListener('click', () => {
                        answerDiv.classList.toggle('open');
                    }, { passive: true });

                    frag.appendChild(card);
                });

                els.flashcardList.innerHTML = '';
                els.flashcardList.appendChild(frag);
            }

            // ==================== ã‚¯ã‚¤ã‚ºãƒ¢ãƒ¼ãƒ‰ ====================
            function startQuiz() {
                quizQuestions = shuffle(DATA);
                currentIndex = 0;
                score = 0;
                wrongList = [];
                answered = false;
                showScreen('quiz');
                renderQuestion();
            }

            function renderQuestion() {
                const item = quizQuestions[currentIndex];
                const total = quizQuestions.length;

                // ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼æ›´æ–°
                els.quizCounter.textContent = `${currentIndex + 1} / ${total}`;
                // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹
                els.quizProgress.style.width = `${((currentIndex) / total) * 100}%`;

                // ã‚«ãƒ†ã‚´ãƒª
                els.quizCat.textContent = item.cat;

                // å•é¡Œã‚¿ã‚¤ãƒ—
                els.quizTypeLabel.textContent = item.type === 'reading' ? 'èª­ã¿ã‚’é¸ã¹' : 'ï¼Ÿã«å…¥ã‚‹æ–‡å­—ã‚’é¸ã¹';

                // å•é¡Œæ–‡
                els.quizQuestion.textContent = item.q;

                // é¸æŠè‚¢ç”Ÿæˆï¼ˆã‚·ãƒ£ãƒƒãƒ•ãƒ«ï¼‰
                const choices = shuffle([item.a, ...item.wrong]);
                const frag = document.createDocumentFragment();

                choices.forEach((choice, idx) => {
                    const btn = document.createElement('button');
                    btn.className = 'choice-btn';
                    btn.innerHTML = `<span class="text-slate-500 text-xs font-bold mr-3">${['A', 'B', 'C', 'D'][idx]}</span>${choice}`;
                    // å³æ™‚åå¿œã®ãŸã‚ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
                    btn.addEventListener('click', () => handleAnswer(choice, item, btn), { passive: true });
                    frag.appendChild(btn);
                });

                els.quizChoices.innerHTML = '';
                els.quizChoices.appendChild(frag);

                answered = false;
            }

            function handleAnswer(selected, item, clickedBtn) {
                // äºŒé‡ã‚¿ãƒƒãƒ—é˜²æ­¢
                if (answered) return;
                answered = true;

                const isCorrect = selected === item.a;

                if (isCorrect) {
                    score++;
                } else {
                    wrongList.push(item);
                }

                // å…¨ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–ã—ã€æ­£è§£/ä¸æ­£è§£ã‚’è¡¨ç¤º
                const btns = els.quizChoices.querySelectorAll('.choice-btn');
                btns.forEach(btn => {
                    btn.classList.add('disabled');
                    // ãƒ†ã‚­ã‚¹ãƒˆä¸­ã®æ­£è§£ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ
                    if (btn.textContent.includes(item.a)) {
                        btn.classList.add('correct');
                    }
                });
                if (!isCorrect) {
                    clickedBtn.classList.add('wrong');
                }

                // å³åº§ã«ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤è¡¨ç¤ºï¼ˆsetTimeoutãªã—ï¼‰
                showResultOverlay(isCorrect, item);
            }

            function showResultOverlay(isCorrect, item) {
                els.overlayIcon.textContent = isCorrect ? 'â­•' : 'âŒ';
                els.overlayTitle.textContent = isCorrect ? 'æ­£è§£ï¼' : 'ä¸æ­£è§£â€¦';
                els.overlayTitle.style.color = isCorrect ? '#4ade80' : '#f87171';
                els.overlayAnswer.textContent = `${item.q}ï¼š${item.a}`;
                els.overlayDesc.textContent = item.desc;

                // æœ€å¾Œã®å•é¡Œã‹ã©ã†ã‹ã§ãƒœã‚¿ãƒ³ãƒ†ã‚­ã‚¹ãƒˆå¤‰æ›´
                const isLast = currentIndex >= quizQuestions.length - 1;
                els.overlayNextBtn.textContent = isLast ? 'çµæœã‚’è¦‹ã‚‹ ğŸ†' : 'æ¬¡ã®å•é¡Œã¸ â†’';

                // å³åº§ã«è¡¨ç¤º
                els.resultOverlay.classList.add('show');
            }

            function nextQuestion() {
                els.resultOverlay.classList.remove('show');

                currentIndex++;
                if (currentIndex >= quizQuestions.length) {
                    showFinalResult();
                } else {
                    renderQuestion();
                }
            }

            // ==================== æœ€çµ‚çµæœ ====================
            function showFinalResult() {
                const total = quizQuestions.length;
                const pct = Math.round((score / total) * 100);

                // çµµæ–‡å­—ã®æ±ºå®š
                if (pct === 100) els.resultEmoji.textContent = 'ğŸ†';
                else if (pct >= 80) els.resultEmoji.textContent = 'ğŸ‰';
                else if (pct >= 60) els.resultEmoji.textContent = 'ğŸ˜Š';
                else if (pct >= 40) els.resultEmoji.textContent = 'ğŸ’ª';
                else els.resultEmoji.textContent = 'ğŸ“–';

                els.resultScore.textContent = `${pct}%`;
                els.resultDetail.textContent = `${score} / ${total} å•æ­£è§£`;

                // ãƒãƒ¼ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
                requestAnimationFrame(() => {
                    els.resultBar.style.width = `${pct}%`;
                });

                // é–“é•ãˆãŸå•é¡Œä¸€è¦§
                if (wrongList.length > 0) {
                    els.resultWrongSection.style.display = 'block';
                    const frag = document.createDocumentFragment();
                    wrongList.forEach(item => {
                        const div = document.createElement('div');
                        div.className = 'bg-slate-800/50 rounded-lg p-3 border border-slate-700/50';
                        div.innerHTML = `
                    <div class="flex justify-between items-center mb-1">
                        <span class="text-white font-bold" style="font-family:'Zen Maru Gothic',sans-serif;">${item.q}</span>
                        <span class="cat-badge">${item.cat}</span>
                    </div>
                    <div class="text-sky-400 text-sm font-bold">${item.a}</div>
                    <div class="text-slate-500 text-xs mt-1">${item.desc}</div>
                `;
                        frag.appendChild(div);
                    });
                    els.resultWrongList.innerHTML = '';
                    els.resultWrongList.appendChild(frag);
                } else {
                    els.resultWrongSection.style.display = 'none';
                }

                showScreen('result');
            }

            // ==================== å…¬é–‹API ====================
            return {
                init,
                goHome,
                startFlashcard,
                startQuiz,
                nextQuestion
            };
        })();

        // DOMæº–å‚™å®Œäº†ã¨åŒæ™‚ã«åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', App.init, { passive: true });
    </script>

</body>

</html>